define("taskList",["taskItem"],function(require,exports,module){var t=require("taskItem"),e=['<header class="hd">','                        <ul class="task-status-nav inline">','                            <li class="inline-item item z-active"><a class="filter-item" data-status="-1">所有</a></li>','                            <li class="inline-item item"><a class="filter-item" data-status="0">未完成</a></li>','                            <li class="inline-item item"><a class="filter-item" data-status="1">已完成</a></li>',"                        </ul>","                    </header>",'                    <section class="bd tasks">',"                        ","                    </section>",'                    <footer class="ft">','                        <a class="btn add-task">','                            <i class="icon icon-add"></i>',"                            新增任务","                        </a>","                    </footer>"].join(""),a=function(t){this.sectionList={},this.el=t};a.prototype.append=function(t,e){var a;this.exist(t)?a=this.sectionList[t]:(a=this.sectionList[t]=this.createSectionEl(t),this.el.append(a)),a.append(e)},a.prototype.remove=function(t){var e=this.sectionList[t];e&&e.children().length<1&&$(e).remove()},a.prototype.exist=function(t){return null!=this.sectionList[t]},a.prototype.createSectionEl=function(t){var e=$('<section class="time-node">');return e.html('<p class="title">'+t+"</p>"),e},a.prototype.reset=function(){this.sectionList={}};var i={};i[touchEve.endEvent+" .filter-item"]="statusChange",i[touchEve.endEvent+" .add-task"]="showAddTaskView";var s=Backbone.MView.extend({tagName:"div",id:"taskList",className:"task-list",events:i,template:_.template(e),initialize:function(t){t=t||{},this.order=2,this.curStatus=-1,this.curCategoryId=t.curCategoryId||-1,this.listenTo(Global_TaskList,"add",this.addTask),this.listenTo(Global_TaskList,"destroy",this.removeTask)},render:function(){var t=this.template();return this.$el.html(t),this.tasksEl=this.$(".tasks"),this.taskGroup=new a(this.tasksEl),this.filterByCategoryId(),this},showAddTaskView:function(){var t="#newtask/"+this.curCategoryId;AppManager.appRouter.navigate(t,{trigger:!0})},updataTipDom:function(){var t=Global_TaskList.filterByCategoryId(this.curCategoryId,this.curStatus);return t.length<1?void this.tasksEl.html('<p class="no-task-tip">还没有任务</p>'):void this.$(".no-task-tip").remove()},filterByCategoryId:function(){var t=Global_TaskList.filterByCategoryId(this.curCategoryId,this.curStatus);this.resetList(t)},statusChange:function(t){var e=t.target;this.$(".inline-item").removeClass("z-active"),$(e.parentNode).addClass("z-active");var a=$(e).attr("data-status")||-1;this.curStatus=a;var i=Global_TaskList.filterByCategoryId(this.curCategoryId,a);this.resetList(i)},resetList:function(t){return this.taskGroup.reset(),t.length<1?void this.tasksEl.html('<p class="no-task-tip">还没有任务</p>'):(this.tasksEl.html(""),void _.each(t,this.addTask,this))},removeTask:function(t){t.get("categoryId")==this.curCategoryId&&this.taskGroup.remove(model.get("time"))},addTask:function(e){if(e.get("categoryId")==this.curCategoryId){var a=new t({model:e}),i=e.get("time");this.taskGroup.append(i,a.render().$el)}},setOptions:function(t){this.curCategoryId=parseInt(t)}});module.exports=s}),define("taskItem",function(require,exports,module){var t=Backbone.View.extend({tagName:"a",className:"item",initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove)},render:function(){var t=JSON.stringify(this.model);return t=JSON.parse(t),1==t.status&&this.$el.addClass("done"),this.$el.html(t.header).attr("href","#task/"+t.autoId),this}});module.exports=t}),define("taskInfo",["taskDetail","taskEdit","m_task","tip"],function(require,exports,module){var t=require("taskDetail"),e=require("taskEdit"),a=require("m_task"),i=require("tip"),s={};s[touchEve.startEvent+" #completeTask"]="completeTask",s[touchEve.endEvent+" #editTask"]="editTask",s[touchEve.endEvent+" #sure"]="saveChange",s[touchEve.endEvent+" #cancel"]="cancelChange",s["change input"]="valueChange",s["change textarea"]="valueChange";var n=Backbone.MView.extend({tagName:"div",id:"taskInfo",className:"task-info",events:s,initialize:function(t){t=t||{},this.order=3,this.curTaskId=t.curTaskId||-1,this.curCategoryId=t.curCategoryId||-1,this.hasChange=!1,this.detailView=null,this.editView=null},render:function(){var i,s=!1;return-1==this.curTaskId&&-1!=this.curCategoryId?(s=!0,i=this.model=new a({categoryId:this.curCategoryId})):i=this.model=Global_TaskList.getTask(this.curTaskId),this.detailView=new t({model:i}),this.editView=new e,this.$el.append(this.detailView.render().$el).append(this.editView.render().$el),this.setEditViewStatus(s),this},valueChange:function(){this.hasChange=!0},completeTask:function(){var t=window.confirm("确定完成任务了吗？");return t?void this.model.completeTask():!1},editTask:function(){this.setEditViewStatus(!0)},updateTask:function(){if(!this.hasChange)return void i.show("没有更改的内容");var t=this.editView.getValue();return this.validate(t)?(this.model.save(t),this.hasChange=!1,void i.show("保存成功")):!1},validate:function(t){return t.header?/^\d{4}-\d{1,2}-\d{1,2}$/.test(t.time)?t.content?!0:(i.show("请输入内容"),!1):(i.show("时间不正确"),!1):(i.show("请输入标题"),!1)},addNewTask:function(){var t=this.editView.getValue();if(!this.validate(t))return!1;t.categoryId=this.curCategoryId;var e=Global_TaskList.addTask(t)[0];this.model=e,this.curTaskId=e.get("autoId"),this.detailView.model=this.model,this.detailView.render(),this.hasChange=!1,i.show("添加成功")},saveChange:function(){-1==this.curTaskId&&-1!=this.curCategoryId?this.addNewTask():this.updateTask()},cancelChange:function(){var t;(!this.hasChange||(t=window.confirm("有未保存的内容，确定取消吗？")))&&(-1==this.curTaskId&&-1!=this.curCategoryId?history.go(-1):this.setEditViewStatus(!1))},setOptions:function(t,e){t=parseInt(t),this.curTaskId=-1,this.curCategoryId=-1,this.hasChange=!1,e?this.curCategoryId=t:this.curTaskId=t},setEditViewStatus:function(t){var e=_.clone(this.model.attributes);this.editView.setActive(t,e)}});module.exports=n}),define("taskEdit",function(require,exports,module){var t=['<header class="hd">','                <input type="text" name="" value="" placeholder="输入标题" class="input-header" id="inputHeader">','                <div class="operates">','                    <a href="javascript:void(0);" id="sure" class="btn btn-sure">确认</a>','                    <a href="javascript:void(0);" id="cancel" class="btn btn-cancel">取消</a>',"                </div>","            </header>",'            <div class="task-time">','                任务时间：<input type="text" value="" placeholder="日期格式：2015-04-02" name="" class="input-time" id="inputTime">',"            </div>",'            <div class="bd">','                <div class="content">','                    <textarea name="" class="input-content" id="inputContent" cols="30" rows="10"></textarea>',"                </div>","            </div>"].join(""),e=Backbone.View.extend({tagName:"div",id:"taskEdit",className:"edit-bd",template:_.template(t),render:function(){var t=this.template();return this.$el.html(t),this.headerEl=this.$(".input-header"),this.timeEl=this.$(".input-time"),this.contentEl=this.$(".input-content"),this},setActive:function(t,e){var a=function(){this.headerEl.val(e.header),this.timeEl.val(e.time),this.contentEl.val(e.content)};t?(a.call(this),this.$el.addClass("z-show")):this.$el.removeClass("z-show")},getValue:function(){var t=this.headerEl.val()||"",e=this.timeEl.val()||"",a=this.contentEl.val()||"";return{header:t,time:e,content:a}}});module.exports=e}),define("taskDetail",function(require,exports,module){var t=['<header class="hd">','                <h4 class="header"><%- header %></h4>',"                <% if(status == 0) { %>",'                    <div class="operates">','                        <a href="javascript:void(0);" id="completeTask" class="icon icon-done btn btn-done"></a>','                        <a href="javascript:void(0);" id="editTask" class="icon icon-edit btn btn-edit"></a>',"                    </div>","                <% } %>","            </header>",'            <div class="task-time">','                任务时间：<span class="time"><%- time %></span>',"            </div>",'            <div class="bd">','                <article class="content">',"                    <%- content %>","                </article>","            </div>"].join(""),e=Backbone.View.extend({tagName:"div",id:"taskDetail",className:"detail-bd",template:_.template(t),initialize:function(){this.listenTo(Global_TaskList,"change",this.render)},render:function(){var t=JSON.stringify(this.model);t=JSON.parse(t);var e=this.template(t);return this.$el.html(e),this}});module.exports=e}),define("index",["categoryItem"],function(require,exports,module){var t=require("categoryItem"),e=['<header class="hd">','                        所有任务 (<span class="all-task-num num">0</span>)',"                    </header>",'                    <section class="bd">','                        <h4 class="title">分类列表</h4>','                        <ul class="categorys">',"                            ","                        </ul>","                    </section>",'                    <footer class="ft">','                        <a class="btn add-category">','                            <i class="icon icon-add"></i>',"                            新增分类","                        </a>","                    </footer>"].join(""),a={};a[touchEve.startEvent+" .add-category"]="toastInputPopup";var i=Backbone.MView.extend({tagName:"div",id:"categoryList",className:"category-list",events:a,template:_.template(e),initialize:function(){this.order=1,this.listenTo(Global_CategoryList,"add",this.addCategory),this.listenTo(Global_TaskList,"all",this.updateTaskNum)},render:function(){var t=this.template();return this.$el.html(t),this.categorysEl=this.$(".categorys"),this.allTaskNumEl=this.$(".all-task-num"),this.updateTaskNum(),this.addAll(),this},updateTaskNum:function(t){this.allTaskNumEl.html(Global_TaskList.length)},addAll:function(){this.categorysEl.html(""),Global_CategoryList.each(this.addCategory,this)},toastInputPopup:function(t){var e=window.prompt("添加分类");if(""==e||null==e)return!1;{var a={name:e};Global_CategoryList.addCategory(a)[0]}},addCategory:function(e){var a=new t({model:e});this.categorysEl.append(a.render().$el)}});module.exports=i}),define("header",function(require,exports,module){var t=["<% if(isIndex) { %>","            <span>GTD Tools</span><small>@by ych</small>","        <% }else { %>",'            <a class="pull-left segue-view-btn back"><%- title %></a>',"        <% } %>"].join(""),e={};e[touchEve.endEvent+" .back"]="back";var a=Backbone.View.extend({el:$(".web-hd").get(0),events:e,template:_.template(t),initialize:function(){this.isIndex=!0,this.title="返回"},render:function(){var t={};t=this.isIndex?{isIndex:!0}:{isIndex:!1,title:this.title||"返回"};var e=this.template(t);return this.isIndex?this.$el.html(e).show(220):this.$el.html(e),this},back:function(){history.back()},setOptions:function(t,e){return this.isIndex=t,e&&(this.title=e),this}});module.exports=a}),define("categoryItem",function(require,exports,module){var t=['    <a class="category-name" href="<% print(\'#category/\' + autoId) %>" data-autoid="<%- autoId%>"><%- name %>(<span class="num"><%- num %></span>)</a>','    <% if(name != "默认分类"){ %>','        <a class="del" data-autoid="<%- autoId%>">×</a>',"    <% } %>"].join(""),e={};e[touchEve.endEvent+" .del"]="removeItem";var a=Backbone.View.extend({tagName:"li",className:"level",template:_.template(t),events:e,initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.listenTo(Global_TaskList,"add",this.updateNum),this.listenTo(Global_TaskList,"remove",this.updateNum)},render:function(){var t=JSON.stringify(this.model);t=JSON.parse(t);var e=Global_TaskList.getCountByCategoryId(t.autoId);t.num=e;var a=this.template(t);return this.$el.html(a),this.numEl=this.$(".num"),this.handlerSub(t.subIds),this},updateNum:function(t){if(t.get("categoryId")==this.model.get("autoId")){var e=Global_TaskList.getCountByCategoryId(this.model.get("autoId"));this.numEl.html(e)}},handlerSub:function(t){if(!(t.length<1)){this.$el.addClass("has-sub-category");for(var e=$('<ul class="sub-category">'),i=0;i<t.length;i++){var s=Global_CategoryList.where({autoId:t[i]}),n=new a({model:s});e.append(n.$el)}this.$el.append(e)}},removeItem:function(){Global_TaskList.removeByCategoryId(this.model.get("autoId")),this.model.destroy()}});module.exports=a}),define("slidePage",function(require,exports,module){var t=function(){for(var t=["oT","mozT","webkitT","msT","t"],e=t.length,a=document.body.style,i=0;e>i;i++){var s=t[i]+"ransition";if(s in a)return t[i].substr(0,t[i].length-1)}return!1}(),e=function(){if(t===!1)return!1;if(""!==t){var e=t+"TransitionEnd";if(("on"+e).toLowerCase()in window)return e}else if("ontransitionend"in window)return"transitionEnd";return!1}();$.fn.slideIn=function(t,a){function i(e){var i="pageshow-anim "+t+"-in "+t+"-in-posi";that.removeClass(i).css("z-index",null),a()}that=this,that.css("z-index",99).addClass("pageshow-anim"),e!==!1?that.one(e,i):setTimeout(i,520),that.addClass(t+"-in-posi"),that.get(0).clientLeft,that.addClass(t+"-in")},$.fn.slideOut=function(t,a){function i(e){var i="pageshow-anim "+t+"-out "+t+"-out-posi";that.removeClass(i).css("z-index",null),a()}that=this,that.addClass("pageshow-anim").css("z-index",99),e!==!1?that.one(e,i):setTimeout(i,520),that.addClass(t+"-out-posi"),that.get(0).clientLeft,that.addClass(t+"-out")}}),define("tip",function(require,exports,module){var t,e,a,i=document,s={tipDom:null,show:function(a){var s=this;null==this.tipDom?(this.tipDom=this.createElement(a),i.body.appendChild(this.tipDom)):this.tipDom.innerHTML=a,t&&clearTimeout(t),t=setTimeout(function(){$(s.tipDom).addClass("in")},10),e&&clearTimeout(e),e=setTimeout(function(){s.hide()},3e3)},hide:function(){var t=this;$(t.tipDom).removeClass("in"),a&&clearTimeout(a),a=setTimeout(function(){i.body.removeChild(t.tipDom),t.tipDom=null},410)},createElement:function(t){var e=i.createElement("div");e.innerHTML=t;var a=12*t.length+30;return $(e).addClass("tip fade out").css("width",a),e}};module.exports=s}),define("c_task",["m_task"],function(require,exports,module){var t=require("m_task"),e=Backbone.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("local-tasks"),comparator:"autoId",getNextAutoId:function(){return this.length?this.last().get("autoId")+1:1},removeByCategoryId:function(t){for(var e=this.where({categoryId:t}),a=0,i=e.length;i>a;a++)e[a].destroy()},filterByCategoryId:function(t,e){e=parseInt(e);var a=[0,1],i={categoryId:t};-1!=a.indexOf(e)&&(i.status=e);var s=this.where(i);return s||[]},getCountByCategoryId:function(t){var e=this.filterByCategoryId(t);return e.length},getTask:function(t){return this.findWhere({autoId:t})},getCount:function(){return this.models.length},addTask:function(t){var e=[],a=t;$.isArray(t)||(a=[t]);for(var i=0;i<a.length;i++){var s=a[i];s.autoId=this.getNextAutoId();var n=this.create(s);e.push(n)}return e}});module.exports=e}),define("m_task",function(require,exports,module){Date.prototype.parse=function(t){var e=this.getFullYear(),a=this.getMonth()+1,i=this.getDate(),s=t;return s=s.replace("yyyy",e),s=s.replace("mm",a),s=s.replace("dd",i)};var t=Backbone.Model.extend({defaults:function(){return{autoId:-1,header:"",status:0,time:(new Date).parse("yyyy-mm-dd"),content:"",categoryId:-1}},completeTask:function(){this.set("status",1),this.save()}});module.exports=t}),define("c_category",["m_category"],function(require,exports,module){var t=require("m_category"),e=Backbone.Collection.extend({model:t,localStorage:new Backbone.LocalStorage("local-categorys"),comparator:"autoId",getNextAutoId:function(){return this.length?this.last().get("autoId")+1:1},removeCategory:function(t){this._removeCategory(t),this.sync()},_removeCategory:function(t){for(var e=this.findWhere({id:t}),a=e.subIds,i=a.length,s=0;i>s;s++)this.removeCategory(a[s]);this.remove(e)},addCategory:function(t){var e=[],a=t;$.isArray(t)||(a=[t]);for(var i=0;i<a.length;i++){var s=a[i];s.autoId=this.getNextAutoId();var n=this.create(s);e.push(n)}return e}});module.exports=e}),define("m_category",function(require,exports,module){var t=Backbone.Model.extend({defaults:function(){return{autoId:-1,name:"no name",subIds:[],parId:-1}}});module.exports=t}),define("app",["m_category","c_category","m_task","c_task","tip","slidePage","categoryItem","header","index","taskDetail","taskEdit","taskInfo","taskItem","taskList","c_category","c_task","header","slidePage"],function(require,exports,module){function t(){null==localStorage.isNotFirstIn&&(localStorage.isNotFirstIn=1,setTimeout(function(){Global_CategoryList.addCategory([{name:"默认分类"},{name:"百度ife项目"}]),Global_TaskList.addTask([{header:"测试1",content:"测试1 content",status:0,time:"2015-5-11",categoryId:1},{header:"测试2",content:"测试2 content",status:1,time:"2015-5-12",categoryId:1}])}))}{var e=(require("m_category"),require("c_category"),require("m_task"),require("c_task"),require("tip"),require("slidePage"),require("categoryItem"),require("header"),require("index"),require("taskDetail"),require("taskEdit"),require("taskInfo"),require("taskItem"),require("taskList"),require("c_category")),a=require("c_task"),i=require("header");require("slidePage")}window.Global_TaskList=new a,window.Global_CategoryList=new e,Global_TaskList.fetch(),Global_CategoryList.fetch(),window.HeaderView=i,t()});