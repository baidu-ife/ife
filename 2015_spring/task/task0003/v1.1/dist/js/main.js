define("min$",[],function(){return function(t){return function e(t){function a(t,a){switch(a=d[0]?e(d[0]):document,t.charAt(0)){case"#":return document.getElementById(t.substring(1));case".":return n(a,t.substring(1));case"[":return i(t);default:if(-1!=t.indexOf(".")){var s=t.split(".");return n(a,s[1],s[0])}if(-1!=t.indexOf("[")){var s=t.split("[");return s[1]="["+s[1],i(s[1],s[0])}return a.getElementsByTagName(t)[0]}}function i(t,e){e=e||"*";var a=document.getElementsByTagName(e);if(t=t.substring(1,t.length-1),-1!=t.indexOf("=")){for(var i=t.split("="),n=0;n<a.length;n++)if(a[n].getAttribute(i[0])==i[1])return a[n]}else for(var n=0;n<a.length;n++)if(a[n].getAttribute(t)||""==a[n].getAttribute(t))return a[n];return""}function n(t,e,a){a=a||"*";for(var i=t.getElementsByTagName(a),n=0;n<i.length;n++)if(i[n].className)for(var d=s(i[n].className),l=d.split(/\s+/),o=0;o<l.length;o++)if(l[o]===e)return i[n];return""}function s(t){var e=/^\s+|\s+$/g;return t.replace(e,"")}t=s(t);var d=[],l=t.indexOf(" ");if(-1==l)return a(t);d=t.split(/\s+/);for(var o=d.length;o>1;o++)return a(d[o-1],d[o-2])}(t)}}),define("localStorage",[],{get:function(t){return JSON.parse(window.localStorage.getItem(t))},save:function(t){var e=JSON.stringify(t);window.localStorage.setItem(t.id,e)},remove:function(t){if(t.chiId.length)for(var e=0,a=t.chiId.length;a>e;e++)arguments.callee(this.get(t.chiId[e]));window.localStorage.removeItem(t.id)},updateParent:function(t,e,a){var i=this.get(t);i[e].push(a),this.save(i)},removeChild:function(t){for(var e=this.get(t.parId),a=0,i=e.chiId.length;i>a;a++)e.chiId[a]==t.id&&(e.chiId.splice(a,1),this.save(e))}}),define("util",[],function(){return{hasClass:function(t,e){var a=t.className;if(!a)return!1;a=a.split(/\s+/);for(var i=0,n=a.length;n>i;i++)if(a[i]===e)return!0;return!1},addClass:function(t,e){this.hasClass(t,e)||(t.className=t.className?[t.className,e].join(" "):e)},removeClass:function(t,e){if(e&&this.hasClass(t,e))for(var a=t.className.split(/\s+/),i=0,n=a.length;n>i;i++)if(a[i]===e){a.splice(i,1);break}t.className=a.join(" ")},isSiblingNode:function(t,e){for(var a=t.parentNode.firstChild;a;a=a.nextSibling)if(a===e)return!0;return!1},show:function(t){this.hasClass(t,"hide")&&this.removeClass(t,"hide"),this.addClass(t,"show")},hide:function(t){this.hasClass(t,"show")&&this.removeClass(t,"show"),this.addClass(t,"hide")},isMobile:function(){return/(iPhone|iPod|Android|ios|iPad)/i.test(navigator.userAgent)},trim:function(t){var e=/^\s+|\s+$/g;return t.replace(e,"")},getFormatDate:function(){var t=new Date,e="";return e=t.getFullYear(),e+="-"+this.addZero(t.getMonth()+1)+"-"+this.addZero(t.getDate())},addZero:function(t){return 10>t?"0"+t:t},addEvent:function(t,e,a){t.evName?t.evName.push(a):t.evName=[a],t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent("on"+e,a)},removeEvent:function(t,e,a){if(a)t.removeEventListener?t.removeEventListener(e,a,!1):t.detachEvent("on"+e,a);else if(t.evName)for(var i=0;i<t.evName.length;i++)removeEvent(t,e,t.evName[i])},delegate:function(t,e,a,i){this.addEvent(t,a,function(t){var t=t||event,a=t.target||t.srcElement;a&&a.nodeName.toLowerCase()===e&&i.call(a,t)})},event:{listeners:[],addEvent:function(t,e,a){e=e.replace(/^on/i,"").toLowerCase();var i=this.listeners,n=function(e){"function"==typeof a&&a.call(t,e)};return t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n),i[i.length]=[t,e,a,n],t},removeEvent:function(t,e,a){e=e.replace(/^on/i,"").toLowerCase();for(var i=this.listeners,n=i.length;n--;){var s=i[n],d=!a;if(s[1]===e&&s[0]===t&&(d||s[2]===a)){var l=s[3];t.removeEventListener?t.removeEventListener(e,l,!1):t.detachEvent&&t.detachEvent("on"+e,l),i.splice(n,1)}}return t},delegate:function(t,e,a,i){}}}}),define("init",["min$","localStorage","util"],function(t,e,a){var i=t("#catalog"),n=e.get("root");if(!n){var s={id:"root",chiId:["defaultId"],unDoneNum:1},d={id:"defaultId",title:"默认分类",chiId:[],parId:"root",unDoneNum:1,taskId:[1111111]},l={id:1111111,title:"测试数据",date:"2015-6-10",taskContent:"测试数据",parId:"defaultCatalog",done:!1};e.save(s),e.save(d),e.save(l)}n=e.get("root"),t(".catalog-all span").innerHTML="("+n.unDoneNum+")";for(var o="",r=0,c=n.chiId.length;c>r;r++){var u=e.get(n.chiId[r]);o+='<li class="catalog1" data-id='+u.id+'><div class="list-item"><i class="iconfont">&#xe603;</i><span class="title">'+u.title+'</span><span class="unDoneNum">('+u.unDoneNum+')</span><i class="arrow"></i></div></li>'}i.innerHTML=o}),define("catalog",["min$","util","localStorage"],function(t,e,a){function i(){this.dialog=t("#dialog"),this.mask=t("#mask"),this.confirm=t("#confirm"),this.type=null,this.init()}return i.prototype={constructor:i,init:function(){this.addCatalog1(),this.activeCatalog(),this.cancelDialog(),this.arrow(),this.addCatalog2(),this.confirmBtn()},addCatalog1:function(){var a=this,i=t(".add-catalog1");e.event.addEvent(i,"click",function(){a.showDialog(),a.type="addCatalog1"})},confirmBtn:function(){function i(){var e=t("#input-text").value,i=document.createElement("li"),n=(new Date).getTime();i.className="catalog1",i.setAttribute("data-id",n);var d='<div class="list-item"><i class="iconfont">&#xe603;</i><span class="title">'+e+'</span><span class="unDoneNum">(0)</span><i class="arrow"></i></div>';i.innerHTML=d,t("#catalog").appendChild(i);var l={id:n,title:e,chiId:[],parId:"root",unDoneNum:0,taskId:[]};a.save(l),a.updateParent("root","chiId",l.id),s.hideDialog()}function n(){var e=t("#input-text").value,i=(new Date).getTime(),n=window.selected.getElementsByTagName("ul")[0];if(n){var d=document.createElement("li");d.className="catalog2",d.setAttribute("data-id",i);var l='<div class="list-item"><i class="iconfont">&#xe605;</i><span class="title">'+e+'</span><span class="unDoneNum">(0)</span><i class="arrow"></i></div>';d.innerHTML=l;var n=window.selected.getElementsByTagName("ul")[0];n.appendChild(d)}else{n=document.createElement("ul"),n.className="show";var l='<li class="catalog2" data-id="'+i+'"><div class="list-item"><i class="iconfont">&#xe605;</i><span class="title">'+e+'</span><span class="unDoneNum">(0)</span><i class="arrow"></i></div></li>';n.innerHTML=l,window.selected.appendChild(n)}var o=window.selected.getAttribute("data-id"),r={id:i,title:e,chiId:[],parId:o,unDoneNum:0,taskId:[]};a.save(r),a.updateParent(o,"chiId",r.id),s.hideDialog()}var s=this;e.event.addEvent(s.confirm,"click",function(){switch(s.type){case"addCatalog1":i();break;case"addCatalog2":n()}})},addCatalog2:function(){var a=this;e.event.addEvent(t(".add-catalog2"),"click",function(){a.showDialog(),a.type="addCatalog2",e.hide(t(".context-menu"))})},showDialog:function(){e.show(this.mask),e.show(this.dialog)},hideDialog:function(){e.hide(this.mask),e.hide(this.dialog)},cancelDialog:function(){var a=this;e.event.addEvent(t("#cancel"),"click",function(){a.hideDialog()})},activeCatalog:function(){var a=t("[data-id=defaultId]");e.addClass(a,"active"),window.selected=a;var i=this;e.event.addEvent(t("#catalog"),"click",function(t){for(var t=t||window.event,a=t.target||t.srcElement;!e.hasClass(a,"catalog1")&&!e.hasClass(a,"catalog2");)a=a.parentNode;e.removeClass(window.selected,"active"),window.selected=a,e.addClass(window.selected,"active"),i.render()})},render:function(){this.showTaskList();var t=window.selected.getAttribute("data-id"),i=a.get(t),n=window.selected.getElementsByTagName("ul")[0]||null;if(n)if(e.hasClass(n,"show")){var s=n.getElementsByTagName("ul")||null;if(s&&s.length)for(var d=0;d<s.length;d++)e.hide(s[d]);e.hide(n)}else e.show(n);else{if(i.chiId.length){for(var l="",d=0,o=i.chiId.length;o>d;d++){var r=a.get(i.chiId[d]),c='<li class="catalog2" data-id="'+r.id+'"><div class="list-item"><i class="iconfont">&#xe605;</i><span class="title">'+r.title+'</span><span class="unDoneNum">('+r.unDoneNum+')</span><i class="arrow"></i></div></li>';l+=c}var n=document.createElement("ul");n.className="show",n.innerHTML=l,window.selected.appendChild(n)}e.isMobile()&&(window.location.href="#task")}},arrow:function(){var a=t(".context-menu");e.event.addEvent(t("#catalog"),"click",function(t){var t=t||window.event,i=t.target||t.srcElement;"i"==i.nodeName.toLowerCase()&&e.hasClass(i,"arrow")&&(e.show(a),a.style.left=t.pageX+20+"px",a.style.top=t.pageY+20+"px")})},showTaskList:function(){function e(t,e){var i="",n={},s=[];!function(t,e){for(var i=0;i<t.taskId.length;i++){var d=a.get(t.taskId[i]);if(!(1==e&&d.done||2==e&&!d.done)){if(d.done)var l='<dd class="done" data-id='+d.id+">"+d.title+"</dd>";else var l="<dd data-id="+d.id+">"+d.title+"</dd>";n[d.date]?n[d.date]+=l:(n[d.date]=l,s.push(d.date))}}for(var i=0;i<t.chiId.length;i++){var o=a.get(t.chiId[i]);arguments.callee(o,e)}}(t,e),s.sort(function(t,e){return t=new Date(t.split("-").toString()).getTime(),e=new Date(e.split("-").toString()).getTime(),t>e?-1:1});for(var d=0;d<s.length;d++)i+="<dl><dt>"+s[d]+"</dt>"+n[s[d]]+"</dl>";return i}var i=a.get(window.selected.getAttribute("data-id"));t("#allTaskList").innerHTML=e(i),t("#unDoneTaskList").innerHTML=e(i,1),t("#doneTaskList").innerHTML=e(i,2)}},i}),define("validator",["util"],function(t){return{title:function(e){return e=t.trim(e),e.length<2?{status:!1,msg:"错误！您当前输入的标题小于2个字符"}:e.length>15?{status:!1,msg:"错误！您当前输入的标题大于15个字符"}:{status:!0}},date:function(e){if(e=t.trim(e).split("-"),3==e.length){var a=new Date(e[0],e[1],e[2]),i=a.getFullYear(),n=a.getMonth(),s=a.getDate();return s==e[2]&&i==e[0]&&n==e[1]?{status:!0}:{status:!1,msg:"请输入与正确的年月日"}}return{status:!1,msg:"请按正确格式YYYY-MM-DD输入年月日"}},taskContent:function(e){return e=t.trim(e),0==e.length?{status:!1,msg:"您任务内容输入为空，请重新输入"}:e.length>100?{status:!1,msg:"您输入超出最大范围100个字符"}:{status:!0}}}}),define("task",["min$","util","localStorage","validator"],function(t,e,a,i){function n(){this.inputTitle=t(".task-title"),this.inputDate=t(".task-date input"),this.inputTask=t(".task-input"),this.allList=t("#allTaskList"),this.unDoneList=t("#unDoneTaskList"),this.doneList=t("#doneTaskList"),this.taskType=null,this.init()}return n.prototype={constructor:n,init:function(){this.addTask(),this.tabTaskList(),this.selectTask(),this.editTask(),this.saveTask(),this.cancelSave(),this.doneTask()},addTask:function(){var a=this;e.event.addEvent(t(".add-new-task"),"click",function(){a.initTaskInput(),a.editing(),a.taskType="newTask",e.isMobile()&&(window.location.hash="details")})},editing:function(){e.show(t(".task-btn")),this.inputTitle.removeAttribute("disabled"),this.inputDate.removeAttribute("disabled"),this.inputTask.removeAttribute("disabled"),e.addClass(this.inputTitle,"editing"),e.addClass(this.inputDate,"editing"),this.inputTitle.focus()},cancelEditing:function(){e.hide(t(".task-btn")),this.inputTitle.setAttribute("disabled",!0),this.inputDate.setAttribute("disabled",!0),this.inputTask.setAttribute("disabled",!0),e.removeClass(this.inputTitle,"editing"),e.removeClass(this.inputDate,"editing")},initTaskInput:function(){this.inputTitle.value="",this.inputDate.value=e.getFormatDate(),this.inputTask.value=""},saveTask:function(){var n=this,s=t(".confirm-save"),d=t(".task-error-tip");e.event.addEvent(s,"click",function(){if(!i.title(n.inputTitle.value).status)return void(d.innerHTML=i.title(n.inputTitle.value).msg);if(!i.date(n.inputDate.value).status)return void(d.innerHTML=i.date(n.inputDate.value).msg);if(!i.taskContent(n.inputTask.value).status)return void(d.innerHTML=i.taskContent(n.inputTask.value).msg);if("newTask"===n.taskType){var t=(new Date).getTime(),e=window.selected.getAttribute("data-id"),s={id:t,title:n.inputTitle.value,date:n.inputDate.value,taskContent:n.inputTask.value,parId:e,done:!1};a.save(s),a.updateParent(e,"taskId",s.id),n.createNewTask(s.title,s.date,s.id)}else if("editTask"===n.taskType){var s=a.get(n.currentTaskId);s.title=n.inputTitle.value,s.date=n.inputDate.value,s.taskContent=n.inputTask.value,a.save(s)}n.cancelEditing(),d.innerHTML=""})},createNewTask:function(e,a,i){function n(e){for(var a=t("#allTaskList").getElementsByTagName("dt"),i=0;i<a.length;i++)if(a[i].innerHTML==e)return a[i].parentNode;return!1}var s=this,d=n(a);if(d){var l=document.createElement("dd");l.setAttribute("data-id",i),l.innerHTML=e,d.appendChild(l);var o=l.cloneNode(!0);s.unDoneList.appendChild(o)}else{var r=document.createElement("dl");r.innerHTML="<dt>"+a+'</dt><dd data-id="'+i+'">'+e+"</dd>",s.allList.appendChild(r);var c=r.cloneNode(!0);s.unDoneList.appendChild(c)}this.updateDoneNum("newTask")},tabTaskList:function(){for(var a=t(".tab-head").getElementsByTagName("button"),i=t(".tab-con").getElementsByTagName("div"),n=0;n<a.length;n++)a[n].index=n;var s=0;e.delegate(t(".tab-head"),"button","click",function(){e.hasClass(this,"active")||(e.removeClass(a[s],"active"),e.removeClass(i[s],"active"),s=this.index,e.addClass(this,"active"),e.addClass(i[s],"active"))})},selectTask:function(){var a=null,i=this;e.delegate(t(".tab-con"),"dd","click",function(){i.currentTaskId=this.getAttribute("data-id"),a!==this&&(a&&e.removeClass(a,"on"),i.showTaskCon(),a=this,e.addClass(a,"on"))})},showTaskCon:function(){var t=a.get(this.currentTaskId);this.inputTitle.value=t.title,this.inputDate.value=t.date,this.inputTask.value=t.taskContent,e.isMobile()&&(window.location.href="#details")},editTask:function(){var a=this;e.event.addEvent(t(".task-edit"),"click",function(){a.editing(),a.taskType="editTask"})},cancelSave:function(){var a=this;e.event.addEvent(t(".cancel-save"),"click",function(){a.cancelEditing(),"newTask"===a.taskType?a.initTaskInput():"editTask"===a.taskType&&a.showTaskCon()})},doneTask:function(){var i=this;e.event.addEvent(t(".task-done"),"click",function(){var t=a.get(i.currentTaskId);if(t.done)alert("此任务已完成！");else{var e=window.confirm("您确认任务完成吗?");if(e){t.done=!0,a.save(t);var n=document.createElement("dl");n.innerHTML="<dt>"+t.date+'</dt><dd data-id="'+t.id+'">'+t.title+"</dd>",i.doneList.appendChild(n),i.updateDoneNum("doneTask")}}})},updateDoneNum:function(t){function e(t){var e=window.selected;do{var i=e.querySelector(".unDoneNum"),n=parseInt(i.innerHTML.match(/\d+/));i.innerHTML="("+(n+t)+")";var s=e.getAttribute("data-id"),d=a.get(s);d.unDoneNum=d.unDoneNum+t,a.save(d),e=e.parentNode.parentNode}while(e&&"LI"===e.nodeName.toUpperCase())}"newTask"==t?e(1):"doneTask"==t&&e(-1)}},n}),define("router",["min$","util"],function(t,e){if(e.isMobile()){window.location.hash="type";var a="#type";e.event.addEvent(window,"hashchange",function(){var i=location.hash,n=t("."+a.substr(1)),s=t("."+i.substr(1));"#type"==a&&"#task"==i||"#task"==a&&"#details"==i?(s.style.display="block",e.addClass(n,"slide out"),e.addClass(s,"slide in"),setTimeout(function(){n.className=n.className.replace(/\s+slide out/,""),s.className=s.className.replace(/\s+slide in/,""),n.style.display="none"},400)):("#task"==a&&"#type"==i||"#details"==a&&"#task"==i)&&(s.style.display="block",e.addClass(n,"slide reverse out"),e.addClass(s,"slide reverse in"),setTimeout(function(){n.className=n.className.replace(/\s+slide reverse out/,""),s.className=s.className.replace(/\s+slide reverse in/,""),n.style.display="none"},400)),a=i})}}),require.config({baseUrl:"js",paths:{},shim:{}}),require(["init","catalog","task","router"],function(t,e,a){new e,new a}),define("main",["init","catalog","task","router"],function(){});